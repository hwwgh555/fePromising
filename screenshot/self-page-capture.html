<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆªå›¾è‡ªå·±é¡µé¢æ¼”ç¤º</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.2);
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }

        .demo-area {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            background-size: 400% 400%;
            animation: gradientMove 3s ease infinite;
            color: white;
            padding: 30px;
            border-radius: 12px;
            text-align: center;
            margin: 20px 0;
        }

        @keyframes gradientMove {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: transform 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn.danger {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
        }

        .result-area {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .result-item {
            flex: 1;
            min-width: 300px;
            background: #f8f9fa;
            border: 2px dashed #ddd;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
        }

        .result-item img, .result-item video {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin: 15px 0;
        }

        .status {
            padding: 12px;
            border-radius: 6px;
            font-weight: bold;
            margin: 15px 0;
        }

        .status.info { background: #d1ecf1; color: #0c5460; }
        .status.success { background: #d4edda; color: #155724; }
        .status.error { background: #f8d7da; color: #721c24; }

        .tips {
            background: #e7f3ff;
            border-left: 4px solid #2196f3;
            padding: 20px;
            margin: 25px 0;
            border-radius: 8px;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-number {
            font-size: 1.8em;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“¸ Screen Capture API æˆªå›¾è‡ªå·±é¡µé¢</h1>
        
        <div class="tips">
            <h3>ğŸ’¡ å…³äºæˆªå›¾è‡ªå·±é¡µé¢</h3>
            <p><strong>å®Œå…¨å¯è¡Œï¼</strong> Screen Capture API å¯ä»¥æˆªå›¾å½“å‰é¡µé¢ã€‚åœ¨å¼¹å‡ºçš„é€‰æ‹©æ¡†ä¸­é€‰æ‹©"æµè§ˆå™¨æ ‡ç­¾é¡µ"æˆ–å½“å‰æ ‡ç­¾é¡µå³å¯ã€‚</p>
            <ul>
                <li>âœ… å¯ä»¥æ•è·åŠ¨æ€å†…å®¹å’ŒåŠ¨ç”»æ•ˆæœ</li>
                <li>âœ… æˆªå›¾è´¨é‡ä¸å±å¹•åˆ†è¾¨ç‡ä¸€è‡´</li>
                <li>âš ï¸ å¦‚æœé¡µé¢æ˜¾ç¤ºè‡ªå·±çš„æˆªå›¾é¢„è§ˆï¼Œä¼šäº§ç”Ÿé€’å½’é•œåƒæ•ˆæœ</li>
                <li>ğŸ”’ éœ€è¦ç”¨æˆ·æ˜ç¡®æˆæƒé€‰æ‹©æ•è·å†…å®¹</li>
            </ul>
        </div>

        <div class="demo-area">
            <h3>ğŸ¨ åŠ¨æ€æ¼”ç¤ºåŒºåŸŸ</h3>
            <p>å½“å‰æ—¶é—´: <span id="current-time"></span></p>
            <p>è¿™ä¸ªåŒºåŸŸæœ‰åŠ¨ç”»èƒŒæ™¯ï¼Œæˆªå›¾æ—¶ä¼šè¢«å®Œæ•´æ•è·</p>
            
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-number" id="visit-count">1,234</div>
                    <div>è®¿é—®æ¬¡æ•°</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="screenshot-count">0</div>
                    <div>æˆªå›¾æ¬¡æ•°</div>
                </div>
            </div>
        </div>

        <div style="text-align: center; margin: 30px 0;">
            <button class="btn" onclick="startSelfCapture()">ğŸ“¸ æˆªå›¾å½“å‰é¡µé¢</button>
            <button class="btn danger" onclick="stopCapture()">â¹ï¸ åœæ­¢æˆªå›¾</button>
        </div>

        <div class="result-area">
            <div class="result-item">
                <h4>ğŸ“º å®æ—¶é¢„è§ˆ</h4>
                <video id="preview-video" autoplay muted style="display: none;"></video>
                <div id="capture-status" class="status info">ç‚¹å‡»"æˆªå›¾å½“å‰é¡µé¢"å¼€å§‹</div>
            </div>
            
            <div class="result-item">
                <h4>ğŸ“· æˆªå›¾ç»“æœ</h4>
                <img id="screenshot-result" style="display: none;" alt="é¡µé¢æˆªå›¾">
                <div id="result-status" class="status info">ç­‰å¾…æˆªå›¾ç”Ÿæˆ...</div>
            </div>
        </div>

        <div class="tips" style="background: #fff3cd; border-left-color: #ffc107;">
            <h3>ğŸ”§ å®é™…åº”ç”¨åœºæ™¯</h3>
            <ul>
                <li><strong>é¡µé¢æ¼”ç¤º</strong> - åˆ¶ä½œç½‘ç«™åŠŸèƒ½æ¼”ç¤ºæˆªå›¾</li>
                <li><strong>é”™è¯¯æŠ¥å‘Š</strong> - ç”ŸæˆåŒ…å«å®Œæ•´é¡µé¢çŠ¶æ€çš„é”™è¯¯æˆªå›¾</li>
                <li><strong>å†…å®¹åˆ†äº«</strong> - å¿«é€Ÿç”Ÿæˆé¡µé¢å¿«ç…§ç”¨äºåˆ†äº«</li>
                <li><strong>è‡ªåŠ¨åŒ–æµ‹è¯•</strong> - éªŒè¯é¡µé¢æ¸²æŸ“æ•ˆæœ</li>
            </ul>
        </div>
    </div>

    <script>
        let mediaStream = null;
        let screenshotCount = 0;

        // æ›´æ–°æ—¶é—´å’Œè®¡æ•°
        function updateDisplay() {
            document.getElementById('current-time').textContent = new Date().toLocaleString('zh-CN');
            
            // æ¨¡æ‹Ÿè®¿é—®è®¡æ•°æ›´æ–°
            const visitCount = Math.floor(1234 + Math.random() * 10);
            document.getElementById('visit-count').textContent = visitCount.toLocaleString();
        }

        // å¼€å§‹æˆªå›¾è‡ªå·±é¡µé¢
        async function startSelfCapture() {
            try {
                updateStatus('capture-status', 'æ­£åœ¨è¯·æ±‚å±å¹•æ•è·æƒé™...', 'info');

                mediaStream = await navigator.mediaDevices.getDisplayMedia({
                    video: { width: { ideal: 1920 }, height: { ideal: 1080 } },
                    audio: false
                });

                const video = document.getElementById('preview-video');
                video.srcObject = mediaStream;
                video.style.display = 'block';

                updateStatus('capture-status', 'âœ… æˆåŠŸï¼è¯·åœ¨å¼¹å‡ºæ¡†ä¸­é€‰æ‹©å½“å‰æ ‡ç­¾é¡µ', 'success');
                updateStatus('result-status', 'â³ 3ç§’åè‡ªåŠ¨æˆªå›¾...', 'info');

                // ç›‘å¬æµç»“æŸ
                mediaStream.getVideoTracks()[0].onended = () => {
                    stopCapture();
                };

                // 3ç§’åè‡ªåŠ¨æˆªå›¾
                setTimeout(takeScreenshot, 3000);

            } catch (error) {
                console.error('æˆªå›¾å¤±è´¥:', error);
                let message = 'æˆªå›¾å¤±è´¥: ';
                
                if (error.name === 'NotAllowedError') {
                    message += 'ç”¨æˆ·æ‹’ç»äº†æˆªå›¾æƒé™ï¼Œæˆ–é€‰æ‹©åˆ—è¡¨ä¸­æ²¡æœ‰å½“å‰é¡µé¢';
                    // æ·»åŠ é¢å¤–çš„æŒ‡å¯¼ä¿¡æ¯
                    setTimeout(() => {
                        updateStatus('capture-status', 
                            'ğŸ’¡ æç¤ºï¼šå¦‚æœé€‰æ‹©åˆ—è¡¨ä¸­æ²¡æœ‰å½“å‰æ ‡ç­¾é¡µï¼Œè¯·å°è¯•é€‰æ‹©"æ•´ä¸ªå±å¹•"æˆ–åˆ‡æ¢åˆ°HTTPSç¯å¢ƒ', 
                            'info');
                    }, 2000);
                } else if (error.name === 'NotFoundError') {
                    message += 'æœªæ‰¾åˆ°å¯æ•è·çš„åª’ä½“æºï¼Œè¿™å¯èƒ½æ˜¯æµè§ˆå™¨é™åˆ¶';
                } else {
                    message += error.message;
                }
                
                updateStatus('capture-status', `âŒ ${message}`, 'error');
            }
        }

        // æˆªå›¾
        function takeScreenshot() {
            if (!mediaStream) return;

            const video = document.getElementById('preview-video');
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');

            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            ctx.drawImage(video, 0, 0);

            const dataUrl = canvas.toDataURL('image/png');
            
            // æ˜¾ç¤ºæˆªå›¾
            const resultImg = document.getElementById('screenshot-result');
            resultImg.src = dataUrl;
            resultImg.style.display = 'block';

            // æ›´æ–°è®¡æ•°
            screenshotCount++;
            document.getElementById('screenshot-count').textContent = screenshotCount;

            updateStatus('result-status', `âœ… æˆªå›¾æˆåŠŸï¼å°ºå¯¸: ${canvas.width}x${canvas.height}`, 'success');

            // è‡ªåŠ¨ä¸‹è½½
            const link = document.createElement('a');
            link.download = `self-page-screenshot-${Date.now()}.png`;
            link.href = dataUrl;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // åœæ­¢æˆªå›¾
        function stopCapture() {
            if (mediaStream) {
                mediaStream.getTracks().forEach(track => track.stop());
                mediaStream = null;

                const video = document.getElementById('preview-video');
                video.style.display = 'none';

                updateStatus('capture-status', 'â¹ï¸ å·²åœæ­¢å±å¹•æ•è·', 'info');
            }
        }

        // æ›´æ–°çŠ¶æ€
        function updateStatus(elementId, message, type) {
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent = message;
                element.className = `status ${type}`;
            }
        }

        // æ£€æŸ¥æµè§ˆå™¨æ”¯æŒ
        function checkSupport() {
            if (!navigator.mediaDevices || !navigator.mediaDevices.getDisplayMedia) {
                updateStatus('capture-status', 'âŒ æµè§ˆå™¨ä¸æ”¯æŒ Screen Capture API', 'error');
            }
        }

        // åˆå§‹åŒ–
        updateDisplay();
        setInterval(updateDisplay, 1000);
        checkSupport();
    </script>
</body>
</html> 