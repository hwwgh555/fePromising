# 📸 截图上传功能使用指南

## 🌟 新增功能

我已经为截图工具增加了完整的图片上传和保存功能：

### ✨ 主要特性
- ✅ **上传到服务器** - 将截图上传到后端API
- ✅ **本地存储** - 本地浏览器存储已保存的图片
- ✅ **图片画廊** - 查看、下载、删除已保存的图片
- ✅ **图片管理** - 添加标题、描述等元数据
- ✅ **模拟模式** - 无后端时自动启用模拟上传
- ✅ **错误处理** - 完善的错误提示和处理

## 🚀 快速开始

### 1. 前端使用

1. 打开 `handleScreenShot.html`
2. 进行截图和编辑
3. 填写图片标题和描述
4. 点击"上传到服务器"按钮

### 2. 后端部署（可选）

如果你想要真实的服务器上传功能：

```bash
# 进入后端目录
cd src/screenshot/

# 安装依赖
npm install

# 启动服务器
npm start

# 或者开发模式（自动重启）
npm run dev
```

服务器将在 `http://localhost:3000` 启动

### 3. 配置上传地址

在前端界面的"服务器设置"部分：
- **上传地址**: 设置为你的API地址（默认: `/api/upload-image`）
- **图片标题**: 必填，为图片添加标题
- **图片描述**: 可选，添加详细描述

## 📋 API 接口说明

### 上传图片
```
POST /api/upload-image
Content-Type: multipart/form-data

参数：
- image: 图片文件 (required)
- title: 图片标题 (required)
- description: 图片描述 (optional)
- timestamp: 时间戳 (optional)

返回：
{
  "success": true,
  "message": "图片上传成功",
  "data": {
    "id": 1699123456789,
    "filename": "screenshot-1699123456789-123456789.png",
    "title": "我的截图",
    "description": "这是一个测试截图",
    "size": 12345,
    "url": "/uploads/screenshot-1699123456789-123456789.png",
    "uploadTime": "2023-11-04T10:30:56.789Z"
  }
}
```

### 获取图片列表
```
GET /api/images

返回：
{
  "success": true,
  "data": [...],
  "total": 10
}
```

### 删除图片
```
DELETE /api/images/:id

返回：
{
  "success": true,
  "message": "图片删除成功"
}
```

## 🎯 功能详解

### 1. 上传功能
- **自动格式转换**: Canvas 自动转换为 PNG 格式
- **文件大小限制**: 默认最大 10MB
- **文件类型验证**: 只允许图片文件
- **唯一文件名**: 自动生成唯一文件名避免冲突

### 2. 模拟模式
当无法连接到服务器时，系统会自动启用模拟模式：
- 模拟网络延迟
- 生成模拟的服务器响应
- 保存到浏览器本地存储
- 所有功能正常使用

### 3. 图片画廊
点击"查看已保存"按钮可以：
- 查看所有已保存的图片
- 显示图片信息（标题、大小、上传时间等）
- 下载单个图片
- 删除不需要的图片

### 4. 本地存储
- 使用 `localStorage` 保存图片数据
- 最多保存 50 张图片（避免存储过载）
- 支持离线查看和管理

## 🔧 自定义配置

### 修改上传地址
```javascript
// 在前端界面直接修改，或者通过代码：
document.getElementById('uploadUrl').value = 'https://your-api.com/upload';
```

### 自定义后端配置
编辑 `server-example.js`：

```javascript
// 修改端口
const PORT = 8080;

// 修改文件大小限制
limits: {
    fileSize: 50 * 1024 * 1024 // 50MB
}

// 修改上传目录
const uploadDir = path.join(__dirname, 'my-uploads');
```

## 🛠️ 部署建议

### 开发环境
```bash
npm run dev  # 使用 nodemon 自动重启
```

### 生产环境
```bash
npm start    # 直接启动
```

### 使用 PM2 部署
```bash
npm install -g pm2
pm2 start server-example.js --name screenshot-server
pm2 monit
```

### Docker 部署
```dockerfile
FROM node:16-alpine
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
EXPOSE 3000
CMD ["npm", "start"]
```

## 🔒 安全考虑

1. **文件类型验证**: 只允许图片格式
2. **文件大小限制**: 防止大文件攻击
3. **路径安全**: 防止路径遍历攻击
4. **CORS 配置**: 根据需要配置跨域
5. **认证授权**: 生产环境建议添加用户认证

## 📱 浏览器兼容性

- ✅ Chrome 60+
- ✅ Firefox 55+
- ✅ Safari 12+
- ✅ Edge 79+

## 🎨 界面截图

工具包含以下界面元素：
- 📸 截图工具区域
- ✏️ 文字编辑控制面板
- 🎨 绘制工具设置
- 🌐 服务器配置区域
- 🔧 操作工具栏
- 🖼️ 图片画廊模态窗口

## 🆘 常见问题

### Q: 上传失败怎么办？
A: 系统会自动启用模拟模式，所有功能正常使用。检查网络连接和服务器状态。

### Q: 如何查看已上传的图片？
A: 点击"查看已保存"按钮，会显示图片画廊。

### Q: 可以批量上传吗？
A: 目前只支持单张上传，但可以连续上传多张。

### Q: 如何删除服务器上的图片？
A: 在图片画廊中点击删除按钮，会同时删除服务器文件和记录。

### Q: 支持哪些图片格式？
A: 截图始终保存为 PNG 格式，确保最佳质量。

## 📞 技术支持

如果你在使用过程中遇到问题：
1. 检查浏览器控制台的错误信息
2. 确认服务器是否正常运行
3. 验证API地址是否正确
4. 查看网络请求状态

## 🔄 更新日志

### v1.0 (当前版本)
- ✅ 基础截图和编辑功能
- ✅ 图片上传到服务器
- ✅ 本地存储和画廊
- ✅ 模拟上传模式
- ✅ 完整的后端示例

---

💡 **提示**: 这个工具可以在没有后端的情况下完全正常工作，所有功能都有本地存储支持！ 